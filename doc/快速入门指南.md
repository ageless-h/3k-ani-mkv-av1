# 3KåŠ¨ç”»å¤„ç†ç³»ç»Ÿ - å¿«é€Ÿå…¥é—¨æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨10åˆ†é’Ÿå†…å®Œæˆé¡¹ç›®éƒ¨ç½²å’Œé¦–æ¬¡è¿è¡Œã€‚

## ğŸ¯ éƒ¨ç½²ç›®æ ‡

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„åŠ¨ç”»è§†é¢‘å¤„ç†ç³»ç»Ÿï¼Œèƒ½å¤Ÿï¼š
- ä»NASè¯»å–åŠ¨ç”»è§†é¢‘
- è½¬æ¢ä¸ºMKV+AV1æ ¼å¼
- æå–åœºæ™¯ä¸­é—´å¸§
- ç”ŸæˆWebPå›¾åƒå½’æ¡£

## ğŸ“‹ å‰ç½®è¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **CPU**: å¤šæ ¸å¤„ç†å™¨ (æ¨è8æ ¸+)
- **GPU**: NVIDIA RTX 4090 (æ”¯æŒAV1ç¡¬ä»¶ç¼–ç )
- **å†…å­˜**: 16GB+ RAM
- **å­˜å‚¨**: 50GB+ å¯ç”¨ç©ºé—´

### è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+, CentOS 8+)
- **Python**: 3.8+
- **Git**: æœ€æ–°ç‰ˆæœ¬
- **FFmpeg**: æ”¯æŒAV1ç¼–ç çš„ç‰ˆæœ¬

### ç½‘ç»œè¦æ±‚
- **Tailscale VPN**: ç”¨äºè¿æ¥NAS
- **ç¨³å®šç½‘ç»œ**: ç”¨äºä¼ è¾“å¤§æ–‡ä»¶

## ğŸš€ ä¸€é”®éƒ¨ç½²

### æ­¥éª¤1: å…‹éš†é¡¹ç›®

```bash
# åœ¨LinuxæœåŠ¡å™¨ä¸Šæ‰§è¡Œ
git clone https://github.com/ageless-h/3k-ani-mkv-av1.git
cd 3k-animation-mkv-av1
```

### æ­¥éª¤2: è¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
python3 deploy.py
```

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. **æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ** - éªŒè¯Pythonã€Gitã€FFmpegç­‰
2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ** - éš”ç¦»Pythonä¾èµ–
3. **å®‰è£…ä¾èµ–åŒ…** - å®‰è£…æ‰€æœ‰å¿…è¦çš„PythonåŒ…
4. **å®‰è£…libwebp** - é«˜æ€§èƒ½WebPè½¬æ¢å·¥å…·
5. **åˆ›å»ºç›®å½•ç»“æ„** - è®¾ç½®æ—¥å¿—å’Œè¾“å‡ºç›®å½•
6. **è¿è¡Œé…ç½®å‘å¯¼** - äº¤äº’å¼é…ç½®ç³»ç»Ÿ

### æ­¥éª¤3: é…ç½®å‘å¯¼

é…ç½®å‘å¯¼ä¼šè¯¢é—®ä»¥ä¸‹ä¿¡æ¯ï¼š

#### éƒ¨ç½²æ¨¡å¼é€‰æ‹©
```
1. å•æœºæ¨¡å¼ (æœ¬åœ°å¤„ç†)
2. è¿œç¨‹æ¨¡å¼ (LinuxæœåŠ¡å™¨å¤„ç†) â† æ¨è
3. ä¸­ä»‹æ¨¡å¼ (é€šè¿‡ä¸­ä»‹æœºä¼ è¾“)
```

#### NASè¿æ¥é…ç½®
- **NAS IPåœ°å€**: Tailscaleç½‘ç»œä¸­çš„NAS IP
- **SSHç”¨æˆ·å**: é€šå¸¸æ˜¯ `root`ã€`admin` æˆ– `ugos`
- **SSHç«¯å£**: é»˜è®¤ `22`

#### è·¯å¾„é…ç½®
- **æºè§†é¢‘ç›®å½•**: NASä¸Šçš„åŠ¨ç”»è§†é¢‘å­˜æ”¾è·¯å¾„
- **è¾“å‡ºç›®å½•**: å¤„ç†ç»“æœä¿å­˜è·¯å¾„
- **ä¸´æ—¶ç›®å½•**: å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„

#### å¤„ç†å‚æ•°
- **æ¯æ‰¹æœ€å¤§é›†æ•°**: æ§åˆ¶å†…å­˜ä½¿ç”¨
- **å¹¶å‘çº¿ç¨‹æ•°**: æ ¹æ®CPUæ ¸å¿ƒæ•°è®¾ç½®
- **WebPè´¨é‡**: å›¾åƒå‹ç¼©è´¨é‡ (æ¨è90%)

## âš™ï¸ é…ç½®ç¤ºä¾‹

### å…¸å‹ç»¿è”äº‘é…ç½®

```python
class Config:
    # NASè¿æ¥
    NAS_IP = "100.74.107.59"
    SSH_USER = "root"
    SSH_PORT = 22
    
    # è·¯å¾„é…ç½®
    SOURCE_DIR = "/volume1/db/5_video/archive"
    OUTPUT_DIR = "/root/output/animation"
    TEMP_DIR = "/tmp/animation_processing"
    
    # å¤„ç†å‚æ•°
    MAX_EPISODES_PER_BATCH = 30
    MAX_WORKERS = 4
    WEBP_QUALITY = 90
    TARGET_SIZE = 2048
```

## ğŸ”§ é¦–æ¬¡è¿è¡Œ

### æ­¥éª¤1: ç¯å¢ƒéªŒè¯

```bash
# æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ
python3 tools/check_environment.py

# æ£€æŸ¥NASè¿æ¥
python3 tools/diagnose_nas.py
```

### æ­¥éª¤2: å‡†å¤‡æ–‡ä»¶åˆ—è¡¨

```bash
# å¦‚æœæœ‰ç°æˆçš„æ–‡ä»¶åˆ—è¡¨
cp your_filelist.txt filelist.txt

# æˆ–è€…ä»NASè·å–æ–‡ä»¶åˆ—è¡¨
python3 tools/ugreen_nas_config.py
```

### æ­¥éª¤3: å¯åŠ¨å¤„ç†

```bash
# å‰å°è¿è¡Œ (æµ‹è¯•ç”¨)
bash run.sh

# åå°è¿è¡Œ (ç”Ÿäº§ç¯å¢ƒ)
nohup bash run.sh > processing.log 2>&1 &
```

### æ­¥éª¤4: ç›‘æ§è¿›åº¦

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f log/processing.log

# æŸ¥çœ‹å¤„ç†è¿›åº¦
tail -f processing.log | grep "è¿›åº¦"

# æ£€æŸ¥GPUä½¿ç”¨æƒ…å†µ
nvidia-smi

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### GPUåŠ é€Ÿé…ç½®

ç¡®ä¿NVIDIAé©±åŠ¨å’ŒCUDAå·²å®‰è£…ï¼š
```bash
# æ£€æŸ¥GPUçŠ¶æ€
nvidia-smi

# æ£€æŸ¥AV1ç¼–ç æ”¯æŒ
ffmpeg -encoders | grep av1_nvenc
```

### å¹¶å‘å¤„ç†è°ƒä¼˜

æ ¹æ®ç¡¬ä»¶é…ç½®è°ƒæ•´å‚æ•°ï¼š
```python
# 4æ ¸CPUæ¨èè®¾ç½®
MAX_WORKERS = 2

# 8æ ¸CPUæ¨èè®¾ç½®  
MAX_WORKERS = 4

# 16æ ¸CPUæ¨èè®¾ç½®
MAX_WORKERS = 6
```

### ç£ç›˜ç©ºé—´ç®¡ç†

```bash
# ç›‘æ§ç£ç›˜ä½¿ç”¨
watch -n 5 'df -h /tmp'

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf /tmp/animation_processing/*

# å‹ç¼©æ—¥å¿—æ–‡ä»¶
gzip log/processing.log
```

## ğŸ› å¸¸è§é—®é¢˜

### Q: SSHè¿æ¥å¤±è´¥ï¼Ÿ
```bash
# æ£€æŸ¥TailscaleçŠ¶æ€
tailscale status

# æµ‹è¯•SSHè¿æ¥
ssh root@100.74.107.59

# æ£€æŸ¥SSHæœåŠ¡
python3 tools/diagnose_nas.py
```

### Q: GPUç¼–ç ä¸å·¥ä½œï¼Ÿ
```bash
# æ£€æŸ¥NVIDIAé©±åŠ¨
nvidia-smi

# æ£€æŸ¥FFmpeg AV1æ”¯æŒ
ffmpeg -encoders | grep av1

# æ£€æŸ¥CUDAç‰ˆæœ¬
nvcc --version
```

### Q: ç£ç›˜ç©ºé—´ä¸è¶³ï¼Ÿ
```bash
# æ£€æŸ¥ç©ºé—´ä½¿ç”¨
df -h

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
python3 -c "
from src.archive_manager import ArchiveManager
manager = ArchiveManager()
manager.cleanup_temp_files('/tmp/animation_processing')
"
```

### Q: å†…å­˜ä¸è¶³ï¼Ÿ
è°ƒæ•´æ‰¹å¤„ç†å¤§å°ï¼š
```python
# å‡å°‘æ¯æ‰¹å¤„ç†çš„é›†æ•°
MAX_EPISODES_PER_BATCH = 10

# å‡å°‘å¹¶å‘çº¿ç¨‹æ•°
MAX_WORKERS = 2
```

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### ç³»ç»ŸæœåŠ¡ç®¡ç†

å¦‚æœå®‰è£…äº†systemdæœåŠ¡ï¼š
```bash
# å¯åŠ¨æœåŠ¡
systemctl start 3k-animation

# åœæ­¢æœåŠ¡
systemctl stop 3k-animation

# æŸ¥çœ‹çŠ¶æ€
systemctl status 3k-animation

# æŸ¥çœ‹æ—¥å¿—
journalctl -u 3k-animation -f
```

### å®šæœŸç»´æŠ¤

```bash
# æ¯å‘¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
find /tmp/animation_processing -type f -mtime +7 -delete

# æ¯æœˆå‹ç¼©æ—§æ—¥å¿—
find log/ -name "*.log" -mtime +30 -exec gzip {} \;

# æ£€æŸ¥ç£ç›˜å¥åº·
smartctl -a /dev/sda
```

## ğŸ¯ ä¸‹ä¸€æ­¥

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. **ä¼˜åŒ–é…ç½®**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´å‚æ•°
2. **æ‰¹é‡å¤„ç†**: å¤„ç†å¤§é‡åŠ¨ç”»è§†é¢‘
3. **ç›‘æ§ä¼˜åŒ–**: è®¾ç½®æŠ¥è­¦å’Œè‡ªåŠ¨åŒ–ç›‘æ§
4. **æ‰©å±•åŠŸèƒ½**: æ ¹æ®éœ€è¦æ·»åŠ æ–°ç‰¹æ€§

## ğŸ“š æ›´å¤šèµ„æº

- [é¡¹ç›®README](../README.md) - å®Œæ•´é¡¹ç›®è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](éƒ¨ç½²æŒ‡å—.md) - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
- [SSHé…ç½®æŒ‡å—](ç»¿è”äº‘SSHå¯ç”¨æŒ‡å—.md) - NAS SSHè®¾ç½®
- [æ•…éšœæ’é™¤](fix_nas_ssh.md) - å¸¸è§é—®é¢˜è§£å†³

---

**æœ‰é—®é¢˜ï¼Ÿ** è¯·æŸ¥çœ‹ [é¡¹ç›®Issues](https://github.com/ageless-h/3k-ani-mkv-av1/issues) æˆ–æäº¤æ–°Issueã€‚ 